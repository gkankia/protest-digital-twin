<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Protest Digital Twin</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="https://api.mapbox.com/mapbox-gl-js/v3.19.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.19.0/mapbox-gl.js"></script>
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
</style>
</head>
<body>
<div id="map"></div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoiam9yam9uZTkwIiwiYSI6ImNrZ3R6M2FvdTBwbmwycXBibGRqM2w2enYifQ.BxjvFSGqefuC9yFCrXC-nQ';

    const BUS_STOP_URL = 'https://raw.githubusercontent.com/gkankia/protest-digital-twin/main/Digital%20Twin/models/bus_stop/scene.gltf';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/jorjone90/cmm58myuk000t01r063yb09t7',
        projection: 'globe',
        zoom: 18,
        center: [44.799, 41.697],
        pitch: 52.76,
        bearing: -132.62,
        antialias: true,
    });

    map.addControl(new mapboxgl.NavigationControl());
    map.scrollZoom.enable();

    map.on('style.load', () => {
        map.setFog({});

        // Register the model
        map.addModel('bus-stop', BUS_STOP_URL);

        // GeoJSON source with one feature per bus stop
        map.addSource('street-furniture', {
            type: 'geojson',
            data: {
                type: 'FeatureCollection',
                features: [
                    {
                        type: 'Feature',
                        id: 1,
                        properties: {
                            model: 'bus-stop',
                            rotation: -63,
                            label: 'Bus Stop - გიმნაზია'
                        },
                        geometry: {
                            type: 'Point',
                            coordinates: [44.798461, 41.697794]
                        }
                    },
                    {
                        type: 'Feature',
                        id: 2,
                        properties: {
                            model: 'bus-stop',
                            rotation: 70,
                            label: 'Bus Stop - ქაშუეთი'
                        },
                        geometry: {
                            type: 'Point',
                            coordinates: [44.798742, 41.697983]
                        }
                    },
                    // ── TEMPLATE: add new objects here ──
                    // {
                    //     type: 'Feature',
                    //     id: 3,
                    //     properties: {
                    //         model: 'bus-stop',
                    //         rotation: 0,
                    //         label: 'Bus Stop 3'
                    //     },
                    //     geometry: {
                    //         type: 'Point',
                    //         coordinates: [44.800, 41.698]
                    //     }
                    // },
                ]
            }
        });

        // Model layer
        map.addLayer({
            id: 'street-furniture-layer',
            type: 'model',
            source: 'street-furniture',
            layout: {
                'model-id': ['get', 'model'],
            },
            paint: {
                'model-scale': [1, 1, 1],        // adjust if too small e.g. [3, 3, 3]
                'model-rotation': [0, 0, ['get', 'rotation']],
                'model-opacity': 1,
            }
        });

        console.log('✅ Models added');
    });
</script>
</body>
</html>